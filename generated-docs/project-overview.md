Last updated: 2025-11-01

# Project Overview

## プロジェクト概要
- Nuked-OPMとZig ccを用いて、Yamaha YM2151エミュレータの音声レンダリングを行います。
- 440Hzのテストトーンを3秒間生成し、出力が無音でないことを検証するC言語プログラムです。
- クロスプラットフォームビルドに対応し、WAVファイル出力およびリアルタイム音声再生機能を提供します。

## 技術スタック
- フロントエンド:
  - Tone.js: Web Audio APIを抽象化し、ブラウザ上で音楽やオーディオを扱うためのJavaScriptライブラリです。
  - Web Audio API: ウェブブラウザ上で高度な音声処理を行うためのAPIで、Tone.jsを通じて利用されます。
- 音楽・オーディオ:
  - Nuked-OPM: Yamaha YM2151 (OPM) FM音源チップを正確にエミュレートするためのC言語ライブラリです。
  - MML (Music Macro Language): 音楽をテキスト形式で記述するための記法パーサーです。
  - miniaudio: リアルタイム音声再生機能で利用される軽量なオーディオライブラリです。
- 開発ツール:
  - Node.js runtime: JavaScript実行環境で、Web関連のツールやスクリプトに使用されます。
- テスト:
  - バッファの非サイレント検証: 生成された音声データが意図通りに無音でないことを確認するテストロジックです。
- ビルドツール:
  - zig cc: Zig言語のコンパイラが提供するC言語コンパイラフロントエンドで、クロスプラットフォームビルドに利用されます。
- 言語機能:
  - C言語: YM2151エミュレータのコアロジックやテスト、音声出力処理が記述されているプログラミング言語です。
- 自動化・CI/CD:
  - GitHub Actions: コードの変更を検知して自動的にテスト、ビルド、デプロイを行うためのCI/CDサービスです。
    - プロジェクト要約自動生成: プロジェクトの概要を自動生成するワークフロー。
    - Issue自動管理: GitHub Issueのライフサイクルを自動化するワークフロー。
    - README多言語翻訳: READMEファイルを複数の言語に自動翻訳するワークフロー。
    - i18n automation: 国際化 (i18n) 関連のタスクを自動化するワークフロー。
- 開発標準:
  - 特定のコーディング規約や品質標準は明示されていませんが、C言語の一般的な慣習に従っています。

## ファイル階層ツリー
```
.
├── .gitignore
├── BUILD.md
├── LICENSE
├── README.md
├── SUMMARY.md
├── build.py
├── generated-docs/
├── issue-notes/
│   ├── 10.md
│   ├── 5.md
│   ├── 6.md
│   ├── 7.md
│   └── 8.md
├── opm.c
├── opm.h
├── src/
│   ├── phase2/
│   │   ├── README.md
│   │   └── wav_output.c
│   └── phase3/
│       ├── README.md
│       ├── miniaudio.h
│       └── real_time_audio.c
└── test_opm.c
```

## ファイル詳細説明
-   `.gitignore`: Gitのバージョン管理から除外するファイルやディレクトリのパターンを定義します。
-   `BUILD.md`: プロジェクトのビルド方法、必要な依存関係、ビルドオプションなどに関する詳細な手順を記載したドキュメントです。
-   `LICENSE`: プロジェクトのソフトウェアライセンス情報（例: MIT License）が記述されており、利用規約や配布条件を示します。
-   `README.md`: プロジェクトの入り口となる主要ドキュメントです。プロジェクト名、概要、特徴、クイックスタートガイド、技術スタックなどの情報がまとめられています。
-   `SUMMARY.md`: プロジェクトの簡潔な要約や主要な成果、目的をまとめたドキュメントです。
-   `build.py`: Pythonで書かれたビルドスクリプトです。Zig ccコンパイラを呼び出してC言語ソースファイルをコンパイルし、実行可能ファイルを生成するなど、ビルドプロセスを自動化します。
-   `generated-docs/`: プロジェクトのドキュメントが自動生成される場合に、それらを格納するためのディレクトリです。
-   `issue-notes/`: プロジェクトのIssueに関する詳細なメモや解決策、議論が記述されたMarkdownファイルを格納するディレクトリです。（来訪者向けのため、個々のファイルの詳細説明は省略）
-   `opm.c`: Yamaha YM2151 (OPM) FM音源チップのエミュレーションコアロジックを実装したC言語ソースファイルです。OPMのレジスタ操作に応じた音声合成処理を担います。
-   `opm.h`: `opm.c`で定義されているYM2151エミュレータの公開API（関数プロトタイプ、定数、構造体など）を宣言するヘッダーファイルです。他のCソースファイルからエミュレータ機能を利用するためにインクルードされます。
-   `src/`: プロジェクトの主要なソースコードが格納されているディレクトリです。
    -   `src/phase2/`: プロジェクトの「フェーズ2」に相当する機能、主にWAVファイル出力に関連するファイルを格納するディレクトリです。
        -   `src/phase2/README.md`: `phase2`ディレクトリ内の機能や目的、使用方法に関する説明が記述されたドキュメントです。
        -   `src/phase2/wav_output.c`: エミュレートされた音声データを標準的なWAV形式のファイルとして保存するためのC言語ソースファイルです。
    -   `src/phase3/`: プロジェクトの「フェーズ3」に相当する機能、主にリアルタイム音声再生に関連するファイルを格納するディレクトリです。
        -   `src/phase3/README.md`: `phase3`ディレクトリ内の機能や目的、使用方法に関する説明が記述されたドキュメントです。
        -   `src/phase3/miniaudio.h`: 軽量なクロスプラットフォームオーディオI/Oライブラリであるminiaudioのシングルヘッダーファイルです。リアルタイム音声再生機能で利用されます。
        -   `src/phase3/real_time_audio.c`: エミュレートされたYM2151の音声を、miniaudioライブラリを利用してシステムのオーディオ出力デバイスでリアルタイムに再生するためのC言語ソースファイルです。
-   `test_opm.c`: YM2151エミュレータの動作を検証するためのテストコードを含むC言語ソースファイルです。440Hzのトーンを生成し、その出力が期待通りに無音ではないことを確認するロジックが含まれています。

## 関数詳細説明
このプロジェクトで利用されている主要な関数を、その役割と機能に基づいて説明します。具体的な引数や戻り値の型はソースコードがないため一般的な記述に留めます。

-   **`OPM_SetIC(opm_instance)`**
    -   **役割**: YM2151エミュレータのインスタンスを初期状態に設定します。
    -   **機能**: 特に、エミュレータが無音状態から適切に音を生成できるように、内部レジスタを初期化し、無音状態を回避するための設定を行います。
    -   **引数**: `opm_instance` (エミュレータのインスタンスを示すポインタ、または構造体)
    -   **戻り値**: なし、または成功/失敗を示す値。

-   **`OPM_Init(params)`**
    -   **役割**: YM2151エミュレータの新規インスタンスを初期化します。
    -   **機能**: エミュレータの内部状態をセットアップし、動作に必要な初期パラメータ（サンプリングレート、クロック周波数など）を設定します。
    -   **引数**: `params` (初期化パラメータを含む構造体または関連情報)
    -   **戻り値**: 初期化されたエミュレータのインスタンスを示すポインタ、またはNULL（失敗時）。

-   **`OPM_Generate(buffer, samples)`**
    -   **役割**: エミュレータの状態に基づいて音声データを生成します。
    -   **機能**: 現在のYM2151レジスタ設定に従って、指定された数のサンプルを計算し、出力バッファに書き込みます。この関数が繰り返し呼び出されることで連続的な音声が生成されます。
    -   **引数**: `buffer` (生成された音声データを格納するポインタ)、`samples` (生成するサンプル数)
    -   **戻り値**: 実際に生成されたサンプル数、またはエラーコード。

-   **`YM2151Write(address, data)`**
    -   **役割**: YM2151エミュレータのレジスタにデータを書き込みます。
    -   **機能**: 実際のYM2151チップと同様に、指定されたアドレスのレジスタに値を設定します。これにより、音色、ピッチ、ボリュームなどの音源パラメータが変更されます。
    -   **引数**: `address` (YM2151レジスタのアドレス)、`data` (レジスタに書き込む値)
    -   **戻り値**: なし。

-   **`main()`**
    -   **役割**: プロジェクトの主要なエントリーポイントです。
    -   **機能**: YM2151エミュレータの初期化、440Hzトーンの生成、3秒間の音声レンダリング、出力バッファの非サイレント検証、WAVファイル出力、またはリアルタイム音声再生といった一連の処理をオーケストレーションします。

-   **`write_wav_file(filename, buffer, sample_rate, num_samples)`**
    -   **役割**: 生成された音声データをWAVファイルとして保存します。
    -   **機能**: 指定されたファイル名でWAVファイルを作成し、提供された音声バッファの内容を適切なヘッダ情報とともに書き込みます。
    -   **引数**: `filename` (出力WAVファイル名)、`buffer` (音声データバッファ)、`sample_rate` (サンプリングレート)、`num_samples` (サンプル数)
    -   **戻り値**: 成功/失敗を示すブール値または整数コード。

-   **`init_audio_playback(callback)`**
    -   **役割**: リアルタイム音声再生システムを初期化します。
    -   **機能**: システムのオーディオデバイスをセットアップし、音声データを供給するためのコールバック関数を登録します。これにより、リアルタイムでの音声出力が可能になります。
    -   **引数**: `callback` (音声データを提供する関数ポインタ)
    -   **戻り値**: 成功/失敗を示すブール値または整数コード。

-   **`audio_data_callback(device, output_buffer, frames)`**
    -   **役割**: リアルタイム音声再生時にオーディオデバイスによって呼び出されるコールバック関数です。
    -   **機能**: オーディオデバイスが音声データを要求した際に、YM2151エミュレータから最新の音声データを取得し、提供された`output_buffer`に書き込みます。
    -   **引数**: `device` (オーディオデバイスのインスタンス)、`output_buffer` (音声データを書き込むバッファ)、`frames` (要求されたフレーム数)
    -   **戻り値**: なし。

## 関数呼び出し階層ツリー
```
関数呼び出し階層を分析できませんでした。

---
Generated at: 2025-11-01 07:06:34 JST
